-- This query sets up data for FY15 mid-year student performance data reporting: ELA Course Grades.
-- Step 1 nests within step 2, which nests within step 3. Replace "*****ABOVE_QUERY*****" with the query text in the preceding step.
-- The final section (QUERY SYNTAX (SINGLE QUERY VERSION)) is the final query that should be set up in a stored procedure in the reporting DB. This step is just a copy of all previous steps, properly nested.
-- All variables with a prefix of "OG" are related to analyses required for FY15 operating goals. Improvement is defined as when a student moves from an F to anywhere in a D grade range, or from anywhere in a D grade range to anywhere in a C grade range, etc.


-- QUERY SYNTAX (Select latest ELA CG, excluding pre/post tagged data points, from RPT_PERFORMANCE_LEVEL -- STEP 1):

SELECT allELA1.CONFIG_ID, allELA1.STUDENT_ID, allELA1.FREQUENCY_PERIOD_ID, allELA1.SKILL_ID, allELA1.SKILL_DESCRIPTION, allELA1.INTERVAL, allELA1.INDICATOR_DESC, allELA1.FREQ_SORT, allELA1.SCHOOL_NAME, allELA1.SITE_NAME, allELA1.STUDENT_NAME, allELA1.SCHOOL_ID, allELA1.SITE_ID, allELA1.PERF_DATE, allELA1.PERFORMANCE_VALUE, allELA1.PERFORMANCE_VALUE_NUMERIC, allELA1.SCALE_LOCAL, allELA1.SCALE_EVAL, allELA1.SCALE_TYPE, allELA1.PERF_DIRECTION, allELA1.PROC_TYPE, allELA1.PERF_RUN_DATE, allELA1.INDICATOR_AREA_ID, allELA1.CONFIG_NAME, allELA1.PRIMARY_CM, allELA1.INTERVENTION_TIME, allELA1.DATA_POINT, allELA1.CG_VALUE_DISPLAY, allELA1.CG_VALUE_NUM, allELA1.CG_LETTER_VIEW, allELA1.CG_LETTER_VIEW_ALL, allELA1.Tag, allELA1.FISCAL_YEAR
FROM ReportCYData.dbo.RPT_PERFORMANCE_LEVEL AS allELA1 LEFT JOIN ReportCYData.dbo.RPT_PERFORMANCE_LEVEL AS allELA2
ON allELA1.STUDENT_ID = allELA2.STUDENT_ID AND allELA1.INDICATOR_DESC = allELA2.INDICATOR_DESC AND allELA1.FREQ_SORT < allELA2.FREQ_SORT
WHERE allELA1.SKILL_DESCRIPTION LIKE 'ELA Course Grade' AND allELA1.Tag IS NULL AND allELA1.FISCAL_YEAR LIKE '2014-2015' AND allELA2.STUDENT_ID IS NULL;


-- QUERY SYNTAX (Merge in columns from RPT_STUDENT_MAIN, RPT_SCHOOL_GRADE, and the selected data points from the query above, to EVAL_ELA (pre/post data). Select post/proxy-post data points, where the post data point is selected if available, otherwise use the latest performance data available. Recode course grade variables in order to analyze data for FY15 operating goals, where F is recoded to 1, D-/D/D+ is recoded to 2, C-/C/C+ is recoded to 3, etc. -- BASED ON ABOVE QUERY -- STEP 2):

SELECT ReportCYData.dbo.RPT_STUDENT_MAIN.SITE_NAME, ReportCYData.dbo.RPT_STUDENT_MAIN.SCHOOL_NAME, ReportCYData.dbo.RPT_STUDENT_MAIN.GRADE_ID, ReportCYData.dbo.RPT_STUDENT_MAIN.DIPLOMAS_NOW_SCHOOL, ReportCYData.dbo.RPT_STUDENT_MAIN.STUDENT_ID, ReportCYData.dbo.RPT_STUDENT_MAIN.SCHOOL_ID, prepost.PRE_ELA_CG_VALUE, prepost.PRE_ELA_CG_VALUE_DISPLAY, prepost.PRE_ELA_CG_VALUE_NUM, prepost.PRE_ELA_DESC, prepost.PRE_ELA_FREQ, prepost.PRE_ELA_TRACK, prepost.PRE_ELA_TRACK_EVAL, prepost.PRE_SCENARIO, prepost.PRE_LETTER_VIEW, prepost.PRE_CG_LETTER_SCALE_ALL, prepost.DOSAGE_CATEGORY, prepost.TTL_TIME, prepost.POST_ELA_CG_VALUE, prepost.POST_ELA_CG_VALUE_DISPLAY, prepost.POST_ELA_CG_VALUE_NUM, prepost.POST_ELA_DESC, prepost.POST_ELA_FREQ, prepost.POST_ELA_TRACK, prepost.POST_ELA_TRACK_EVAL, prepost.POST_SCENARIO, prepost.POST_LETTER_VIEW, prepost.POST_CG_LETTER_SCALE_ALL, prepost.LETTERGADE_CHANGE_ACTUAL, prepost.LETTERGADE_CHANGE_GENERAL, prepost.CG_Performance_Level_Change, prepost.CG_Change, prepost.Enrollment_Duration, prepost.ENROLL_DAYS, prepost.STATUS_SITE_DOSAGE_GOAL, prepost.SITE_DOSAGE_GOAL, prepost.Attendance_IA, prepost.ELA_IA, prepost.Math_IA, prepost.Behavior_IA, prepost.FISCAL_YEAR, ReportCYData.dbo.RPT_SCHOOL_GRADE.INDICATOR_ID, ReportCYData.dbo.RPT_SCHOOL_GRADE.B_RULE_VAL1, ReportCYData.dbo.RPT_SCHOOL_GRADE.B_RULE_VAL2, ReportCYData.dbo.RPT_SCHOOL_GRADE.B_RULE_VAL3, ReportCYData.dbo.RPT_SCHOOL_GRADE.B_RULE_VAL4, ReportCYData.dbo.RPT_SCHOOL_GRADE.B_RULE_VAL5,
CASE WHEN ReportCYData.dbo.RPT_STUDENT_MAIN.GRADE_ID = 21 THEN -1 WHEN ReportCYData.dbo.RPT_STUDENT_MAIN.GRADE_ID = 22 THEN 0 ELSE ReportCYData.dbo.RPT_STUDENT_MAIN.GRADE_ID END AS GRADE_ID_RECODE,
CASE WHEN prepost.TTL_TIME >= ReportCYData.dbo.RPT_SCHOOL_GRADE.B_RULE_VAL2 THEN 1 WHEN prepost.TTL_TIME < ReportCYData.dbo.RPT_SCHOOL_GRADE.B_RULE_VAL2 THEN 0 ELSE NULL END AS MY_MET_MARCH_DOSAGE,
MY_PROXY_ELA_CG.INTERVAL AS PROXY_ELA_FREQ, MY_PROXY_ELA_CG.SCALE_LOCAL AS PROXY_ELA_TRACK, MY_PROXY_ELA_CG.CG_LETTER_VIEW AS PROXY_LETTER_VIEW, MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL AS PROXY_CG_LETTER_SCALE_ALL,
CASE WHEN prepost.POST_ELA_FREQ IS NULL AND (prepost.PRE_ELA_FREQ < MY_PROXY_ELA_CG.INTERVAL OR prepost.PRE_ELA_FREQ LIKE 'ELA/Literacy PrYr/Cumulative') THEN MY_PROXY_ELA_CG.INTERVAL ELSE prepost.POST_ELA_FREQ END AS MY_ELA_FREQ,
CASE WHEN prepost.POST_ELA_FREQ IS NULL AND (prepost.PRE_ELA_FREQ < MY_PROXY_ELA_CG.INTERVAL OR prepost.PRE_ELA_FREQ LIKE 'ELA/Literacy PrYr/Cumulative') THEN MY_PROXY_ELA_CG.SCALE_LOCAL ELSE prepost.POST_ELA_TRACK END AS MY_ELA_TRACK,
CASE WHEN prepost.POST_ELA_FREQ IS NULL AND (prepost.PRE_ELA_FREQ < MY_PROXY_ELA_CG.INTERVAL OR prepost.PRE_ELA_FREQ LIKE 'ELA/Literacy PrYr/Cumulative') THEN MY_PROXY_ELA_CG.CG_LETTER_VIEW ELSE prepost.POST_LETTER_VIEW END AS MY_LETTER_VIEW,
CASE WHEN prepost.POST_ELA_FREQ IS NULL AND (prepost.PRE_ELA_FREQ < MY_PROXY_ELA_CG.INTERVAL OR prepost.PRE_ELA_FREQ LIKE 'ELA/Literacy PrYr/Cumulative') THEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL ELSE prepost.POST_CG_LETTER_SCALE_ALL END AS MY_CG_LETTER_SCALE_ALL,
CASE WHEN prepost.PRE_CG_LETTER_SCALE_ALL LIKE '1' THEN 1 WHEN prepost.PRE_CG_LETTER_SCALE_ALL LIKE '2' THEN 2 WHEN prepost.PRE_CG_LETTER_SCALE_ALL LIKE '3' THEN 2 WHEN prepost.PRE_CG_LETTER_SCALE_ALL LIKE '4' THEN 2 WHEN prepost.PRE_CG_LETTER_SCALE_ALL LIKE '5' THEN 3 WHEN prepost.PRE_CG_LETTER_SCALE_ALL LIKE '6' THEN 3 WHEN prepost.PRE_CG_LETTER_SCALE_ALL LIKE '7' THEN 3 WHEN prepost.PRE_CG_LETTER_SCALE_ALL LIKE '8' THEN 4 WHEN prepost.PRE_CG_LETTER_SCALE_ALL LIKE '9' THEN 4 WHEN prepost.PRE_CG_LETTER_SCALE_ALL LIKE '10' THEN 4 WHEN prepost.PRE_CG_LETTER_SCALE_ALL LIKE '11' THEN 5 WHEN prepost.PRE_CG_LETTER_SCALE_ALL LIKE '12' THEN 5 WHEN prepost.PRE_CG_LETTER_SCALE_ALL LIKE '13' THEN 5 ELSE NULL END AS OG_PRE_ELA_CG_NUM,
CASE WHEN prepost.POST_CG_LETTER_SCALE_ALL LIKE '1' THEN 1 WHEN prepost.POST_CG_LETTER_SCALE_ALL LIKE '2' THEN 2 WHEN prepost.POST_CG_LETTER_SCALE_ALL LIKE '3' THEN 2 WHEN prepost.POST_CG_LETTER_SCALE_ALL LIKE '4' THEN 2 WHEN prepost.POST_CG_LETTER_SCALE_ALL LIKE '5' THEN 3 WHEN prepost.POST_CG_LETTER_SCALE_ALL LIKE '6' THEN 3 WHEN prepost.POST_CG_LETTER_SCALE_ALL LIKE '7' THEN 3 WHEN prepost.POST_CG_LETTER_SCALE_ALL LIKE '8' THEN 4 WHEN prepost.POST_CG_LETTER_SCALE_ALL LIKE '9' THEN 4 WHEN prepost.POST_CG_LETTER_SCALE_ALL LIKE '10' THEN 4 WHEN prepost.POST_CG_LETTER_SCALE_ALL LIKE '11' THEN 5 WHEN prepost.POST_CG_LETTER_SCALE_ALL LIKE '12' THEN 5 WHEN prepost.POST_CG_LETTER_SCALE_ALL LIKE '13' THEN 5 ELSE NULL END AS OG_POST_ELA_CG_NUM,
CASE WHEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL LIKE '1' THEN 1 WHEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL LIKE '2' THEN 2 WHEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL LIKE '3' THEN 2 WHEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL LIKE '4' THEN 2 WHEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL LIKE '5' THEN 3 WHEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL LIKE '6' THEN 3 WHEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL LIKE '7' THEN 3 WHEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL LIKE '8' THEN 4 WHEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL LIKE '9' THEN 4 WHEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL LIKE '10' THEN 4 WHEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL LIKE '11' THEN 5 WHEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL LIKE '12' THEN 5 WHEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL LIKE '13' THEN 5 ELSE NULL END AS OG_PROXY_ELA_CG_NUM
FROM ReportCYData.dbo.RPT_SCHOOL_GRADE INNER JOIN (ReportCYData.dbo.RPT_STUDENT_MAIN INNER JOIN (ReportCYData.dbo.EVAL_ELA AS prepost LEFT JOIN
(*****ABOVE_QUERY*****)
AS MY_PROXY_ELA_CG ON (prepost.STUDENT_ID = MY_PROXY_ELA_CG.STUDENT_ID)) ON (ReportCYData.dbo.RPT_STUDENT_MAIN.STUDENT_ID = prepost.STUDENT_ID)) ON (ReportCYData.dbo.RPT_SCHOOL_GRADE.SCHOOL_ID = prepost.SCHOOL_ID AND ReportCYData.dbo.RPT_SCHOOL_GRADE.GRADE_ID = ReportCYData.dbo.RPT_STUDENT_MAIN.GRADE_ID)
WHERE ReportCYData.dbo.RPT_SCHOOL_GRADE.INDICATOR_ID = 3 AND ReportCYData.dbo.RPT_SCHOOL_GRADE.FISCAL_YEAR LIKE '2014-2015' AND prepost.FISCAL_YEAR LIKE '2014-2015';


-- QUERY SYNTAX (Calculate additional post/proxy-post and MY/EOY operating goal variables -- BASED ON ABOVE QUERY -- STEP 3 -- this extra step is required since calculations on new variables can't reference variables that were just created in the same query):

SELECT MY_PROXY_ELA_CG2.SITE_NAME, MY_PROXY_ELA_CG2.SCHOOL_NAME, MY_PROXY_ELA_CG2.GRADE_ID, MY_PROXY_ELA_CG2.DIPLOMAS_NOW_SCHOOL, MY_PROXY_ELA_CG2.STUDENT_ID, MY_PROXY_ELA_CG2.SCHOOL_ID, MY_PROXY_ELA_CG2.PRE_ELA_CG_VALUE, MY_PROXY_ELA_CG2.PRE_ELA_CG_VALUE_DISPLAY, MY_PROXY_ELA_CG2.PRE_ELA_CG_VALUE_NUM, MY_PROXY_ELA_CG2.PRE_ELA_DESC, MY_PROXY_ELA_CG2.PRE_ELA_FREQ, MY_PROXY_ELA_CG2.PRE_ELA_TRACK, MY_PROXY_ELA_CG2.PRE_ELA_TRACK_EVAL, MY_PROXY_ELA_CG2.PRE_SCENARIO, MY_PROXY_ELA_CG2.PRE_LETTER_VIEW, MY_PROXY_ELA_CG2.PRE_CG_LETTER_SCALE_ALL, MY_PROXY_ELA_CG2.DOSAGE_CATEGORY, MY_PROXY_ELA_CG2.TTL_TIME, MY_PROXY_ELA_CG2.POST_ELA_CG_VALUE, MY_PROXY_ELA_CG2.POST_ELA_CG_VALUE_DISPLAY, MY_PROXY_ELA_CG2.POST_ELA_CG_VALUE_NUM, MY_PROXY_ELA_CG2.POST_ELA_DESC, MY_PROXY_ELA_CG2.POST_ELA_FREQ, MY_PROXY_ELA_CG2.POST_ELA_TRACK, MY_PROXY_ELA_CG2.POST_ELA_TRACK_EVAL, MY_PROXY_ELA_CG2.POST_SCENARIO, MY_PROXY_ELA_CG2.POST_LETTER_VIEW, MY_PROXY_ELA_CG2.POST_CG_LETTER_SCALE_ALL, MY_PROXY_ELA_CG2.LETTERGADE_CHANGE_ACTUAL, MY_PROXY_ELA_CG2.LETTERGADE_CHANGE_GENERAL, MY_PROXY_ELA_CG2.CG_Performance_Level_Change, MY_PROXY_ELA_CG2.CG_Change, MY_PROXY_ELA_CG2.Enrollment_Duration, MY_PROXY_ELA_CG2.ENROLL_DAYS, MY_PROXY_ELA_CG2.STATUS_SITE_DOSAGE_GOAL, MY_PROXY_ELA_CG2.SITE_DOSAGE_GOAL, MY_PROXY_ELA_CG2.Attendance_IA, MY_PROXY_ELA_CG2.ELA_IA, MY_PROXY_ELA_CG2.Math_IA, MY_PROXY_ELA_CG2.Behavior_IA, MY_PROXY_ELA_CG2.FISCAL_YEAR, MY_PROXY_ELA_CG2.INDICATOR_ID, MY_PROXY_ELA_CG2.B_RULE_VAL1, MY_PROXY_ELA_CG2.B_RULE_VAL2, MY_PROXY_ELA_CG2.B_RULE_VAL3, MY_PROXY_ELA_CG2.B_RULE_VAL4, MY_PROXY_ELA_CG2.B_RULE_VAL5, MY_PROXY_ELA_CG2.GRADE_ID_RECODE, MY_PROXY_ELA_CG2.MY_MET_MARCH_DOSAGE, MY_PROXY_ELA_CG2.PROXY_ELA_FREQ, MY_PROXY_ELA_CG2.PROXY_ELA_TRACK, MY_PROXY_ELA_CG2.PROXY_LETTER_VIEW, MY_PROXY_ELA_CG2.PROXY_CG_LETTER_SCALE_ALL, MY_PROXY_ELA_CG2.MY_ELA_FREQ, MY_PROXY_ELA_CG2.MY_ELA_TRACK, MY_PROXY_ELA_CG2.MY_LETTER_VIEW, MY_PROXY_ELA_CG2.MY_CG_LETTER_SCALE_ALL,
CASE WHEN MY_PROXY_ELA_CG2.PRE_LETTER_VIEW IS NOT NULL AND MY_PROXY_ELA_CG2.MY_LETTER_VIEW IS NOT NULL THEN MY_PROXY_ELA_CG2.PRE_LETTER_VIEW + ' to ' + MY_PROXY_ELA_CG2.MY_LETTER_VIEW ELSE NULL END AS MY_LETTERGRADE_CHANGE_ACTUAL,
CASE WHEN MY_PROXY_ELA_CG2.PRE_ELA_TRACK IS NOT NULL AND MY_PROXY_ELA_CG2.MY_ELA_TRACK IS NOT NULL THEN MY_PROXY_ELA_CG2.PRE_ELA_TRACK + ' to ' + MY_PROXY_ELA_CG2.MY_ELA_TRACK ELSE NULL END AS MY_PERF_CHANGE,
MY_PROXY_ELA_CG2.OG_PRE_ELA_CG_NUM, MY_PROXY_ELA_CG2.OG_POST_ELA_CG_NUM, MY_PROXY_ELA_CG2.OG_PROXY_ELA_CG_NUM,
CASE WHEN MY_PROXY_ELA_CG2.POST_ELA_FREQ IS NULL AND (MY_PROXY_ELA_CG2.PRE_ELA_FREQ < MY_PROXY_ELA_CG2.PROXY_ELA_FREQ OR MY_PROXY_ELA_CG2.PRE_ELA_FREQ LIKE 'ELA/Literacy PrYr/Cumulative') THEN MY_PROXY_ELA_CG2.OG_PROXY_ELA_CG_NUM ELSE MY_PROXY_ELA_CG2.OG_POST_ELA_CG_NUM END AS OG_MY_ELA_CG_NUM
FROM
(*****ABOVE_QUERY*****)
AS MY_PROXY_ELA_CG2;


-- QUERY SYNTAX (Re-populate old table, merge in columns from RPT_LETTER_CHANGE_DEGREE for mid-year post/proxy-post change variable "LetterGradeChange_general", calculate final MY/EOY operating goal variables -- BASED ON ABOVE QUERY -- STEP 4 -- this extra step is required since calculations/joins on new variables can't reference variables that were just created in the same query):

DROP TABLE ImpactAnalytics.dbo.FY15_MY_ELA_CG_subtable
SELECT ELACG.*, LETTERCHANGE.LetterGradeChange_general AS MY_Change,
CASE WHEN ELACG.OG_PRE_ELA_CG_NUM < ELACG.OG_MY_ELA_CG_NUM THEN 'Increase' WHEN ELACG.OG_PRE_ELA_CG_NUM = ELACG.OG_MY_ELA_CG_NUM THEN 'No Change' WHEN ELACG.OG_PRE_ELA_CG_NUM > ELACG.OG_MY_ELA_CG_NUM THEN 'Decrease' ELSE 'Insufficient Data' END AS OG_MY_ELA_CG_CHANGE,
CASE WHEN ELACG.OG_PRE_ELA_CG_NUM < ELACG.OG_POST_ELA_CG_NUM THEN 'Increase' WHEN ELACG.OG_PRE_ELA_CG_NUM = ELACG.OG_POST_ELA_CG_NUM THEN 'No Change' WHEN ELACG.OG_PRE_ELA_CG_NUM > ELACG.OG_POST_ELA_CG_NUM THEN 'Increase' ELSE 'Insufficient Data' END AS OG_EOY_ELA_CG_CHANGE
INTO ImpactAnalytics.dbo.FY15_MY_ELA_CG_subtable
FROM
(*****ABOVE_QUERY*****)
AS ELACG LEFT JOIN ReportCYData.dbo.RPT_LETTER_CHANGE_DEGREE AS LETTERCHANGE
ON ELACG.MY_LETTERGRADE_CHANGE_ACTUAL LIKE LETTERCHANGE.LetterGrade_Change_Actual
ORDER BY SITE_NAME, SCHOOL_NAME, GRADE_ID, STUDENT_ID;


-- QUERY SYNTAX (SINGLE QUERY VERSION):

DROP TABLE ImpactAnalytics.dbo.FY15_MY_ELA_CG_subtable
SELECT ELACG.*, LETTERCHANGE.LetterGradeChange_general AS MY_Change,
CASE WHEN ELACG.OG_PRE_ELA_CG_NUM < ELACG.OG_MY_ELA_CG_NUM THEN 'Increase' WHEN ELACG.OG_PRE_ELA_CG_NUM = ELACG.OG_MY_ELA_CG_NUM THEN 'No Change' WHEN ELACG.OG_PRE_ELA_CG_NUM > ELACG.OG_MY_ELA_CG_NUM THEN 'Decrease' ELSE 'Insufficient Data' END AS OG_MY_ELA_CG_CHANGE,
CASE WHEN ELACG.OG_PRE_ELA_CG_NUM < ELACG.OG_POST_ELA_CG_NUM THEN 'Increase' WHEN ELACG.OG_PRE_ELA_CG_NUM = ELACG.OG_POST_ELA_CG_NUM THEN 'No Change' WHEN ELACG.OG_PRE_ELA_CG_NUM > ELACG.OG_POST_ELA_CG_NUM THEN 'Increase' ELSE 'Insufficient Data' END AS OG_EOY_ELA_CG_CHANGE
INTO ImpactAnalytics.dbo.FY15_MY_ELA_CG_subtable
FROM
(SELECT MY_PROXY_ELA_CG2.SITE_NAME, MY_PROXY_ELA_CG2.SCHOOL_NAME, MY_PROXY_ELA_CG2.GRADE_ID, MY_PROXY_ELA_CG2.DIPLOMAS_NOW_SCHOOL, MY_PROXY_ELA_CG2.STUDENT_ID, MY_PROXY_ELA_CG2.SCHOOL_ID, MY_PROXY_ELA_CG2.PRE_ELA_CG_VALUE, MY_PROXY_ELA_CG2.PRE_ELA_CG_VALUE_DISPLAY, MY_PROXY_ELA_CG2.PRE_ELA_CG_VALUE_NUM, MY_PROXY_ELA_CG2.PRE_ELA_DESC, MY_PROXY_ELA_CG2.PRE_ELA_FREQ, MY_PROXY_ELA_CG2.PRE_ELA_TRACK, MY_PROXY_ELA_CG2.PRE_ELA_TRACK_EVAL, MY_PROXY_ELA_CG2.PRE_SCENARIO, MY_PROXY_ELA_CG2.PRE_LETTER_VIEW, MY_PROXY_ELA_CG2.PRE_CG_LETTER_SCALE_ALL, MY_PROXY_ELA_CG2.DOSAGE_CATEGORY, MY_PROXY_ELA_CG2.TTL_TIME, MY_PROXY_ELA_CG2.POST_ELA_CG_VALUE, MY_PROXY_ELA_CG2.POST_ELA_CG_VALUE_DISPLAY, MY_PROXY_ELA_CG2.POST_ELA_CG_VALUE_NUM, MY_PROXY_ELA_CG2.POST_ELA_DESC, MY_PROXY_ELA_CG2.POST_ELA_FREQ, MY_PROXY_ELA_CG2.POST_ELA_TRACK, MY_PROXY_ELA_CG2.POST_ELA_TRACK_EVAL, MY_PROXY_ELA_CG2.POST_SCENARIO, MY_PROXY_ELA_CG2.POST_LETTER_VIEW, MY_PROXY_ELA_CG2.POST_CG_LETTER_SCALE_ALL, MY_PROXY_ELA_CG2.LETTERGADE_CHANGE_ACTUAL, MY_PROXY_ELA_CG2.LETTERGADE_CHANGE_GENERAL, MY_PROXY_ELA_CG2.CG_Performance_Level_Change, MY_PROXY_ELA_CG2.CG_Change, MY_PROXY_ELA_CG2.Enrollment_Duration, MY_PROXY_ELA_CG2.ENROLL_DAYS, MY_PROXY_ELA_CG2.STATUS_SITE_DOSAGE_GOAL, MY_PROXY_ELA_CG2.SITE_DOSAGE_GOAL, MY_PROXY_ELA_CG2.Attendance_IA, MY_PROXY_ELA_CG2.ELA_IA, MY_PROXY_ELA_CG2.Math_IA, MY_PROXY_ELA_CG2.Behavior_IA, MY_PROXY_ELA_CG2.FISCAL_YEAR, MY_PROXY_ELA_CG2.INDICATOR_ID, MY_PROXY_ELA_CG2.B_RULE_VAL1, MY_PROXY_ELA_CG2.B_RULE_VAL2, MY_PROXY_ELA_CG2.B_RULE_VAL3, MY_PROXY_ELA_CG2.B_RULE_VAL4, MY_PROXY_ELA_CG2.B_RULE_VAL5, MY_PROXY_ELA_CG2.GRADE_ID_RECODE, MY_PROXY_ELA_CG2.MY_MET_MARCH_DOSAGE, MY_PROXY_ELA_CG2.PROXY_ELA_FREQ, MY_PROXY_ELA_CG2.PROXY_ELA_TRACK, MY_PROXY_ELA_CG2.PROXY_LETTER_VIEW, MY_PROXY_ELA_CG2.PROXY_CG_LETTER_SCALE_ALL, MY_PROXY_ELA_CG2.MY_ELA_FREQ, MY_PROXY_ELA_CG2.MY_ELA_TRACK, MY_PROXY_ELA_CG2.MY_LETTER_VIEW, MY_PROXY_ELA_CG2.MY_CG_LETTER_SCALE_ALL,
CASE WHEN MY_PROXY_ELA_CG2.PRE_LETTER_VIEW IS NOT NULL AND MY_PROXY_ELA_CG2.MY_LETTER_VIEW IS NOT NULL THEN MY_PROXY_ELA_CG2.PRE_LETTER_VIEW + ' to ' + MY_PROXY_ELA_CG2.MY_LETTER_VIEW ELSE NULL END AS MY_LETTERGRADE_CHANGE_ACTUAL,
CASE WHEN MY_PROXY_ELA_CG2.PRE_ELA_TRACK IS NOT NULL AND MY_PROXY_ELA_CG2.MY_ELA_TRACK IS NOT NULL THEN MY_PROXY_ELA_CG2.PRE_ELA_TRACK + ' to ' + MY_PROXY_ELA_CG2.MY_ELA_TRACK ELSE NULL END AS MY_PERF_CHANGE,
MY_PROXY_ELA_CG2.OG_PRE_ELA_CG_NUM, MY_PROXY_ELA_CG2.OG_POST_ELA_CG_NUM, MY_PROXY_ELA_CG2.OG_PROXY_ELA_CG_NUM,
CASE WHEN MY_PROXY_ELA_CG2.POST_ELA_FREQ IS NULL AND (MY_PROXY_ELA_CG2.PRE_ELA_FREQ < MY_PROXY_ELA_CG2.PROXY_ELA_FREQ OR MY_PROXY_ELA_CG2.PRE_ELA_FREQ LIKE 'ELA/Literacy PrYr/Cumulative') THEN MY_PROXY_ELA_CG2.OG_PROXY_ELA_CG_NUM ELSE MY_PROXY_ELA_CG2.OG_POST_ELA_CG_NUM END AS OG_MY_ELA_CG_NUM
FROM
(SELECT ReportCYData.dbo.RPT_STUDENT_MAIN.SITE_NAME, ReportCYData.dbo.RPT_STUDENT_MAIN.SCHOOL_NAME, ReportCYData.dbo.RPT_STUDENT_MAIN.GRADE_ID, ReportCYData.dbo.RPT_STUDENT_MAIN.DIPLOMAS_NOW_SCHOOL, ReportCYData.dbo.RPT_STUDENT_MAIN.STUDENT_ID, ReportCYData.dbo.RPT_STUDENT_MAIN.SCHOOL_ID, prepost.PRE_ELA_CG_VALUE, prepost.PRE_ELA_CG_VALUE_DISPLAY, prepost.PRE_ELA_CG_VALUE_NUM, prepost.PRE_ELA_DESC, prepost.PRE_ELA_FREQ, prepost.PRE_ELA_TRACK, prepost.PRE_ELA_TRACK_EVAL, prepost.PRE_SCENARIO, prepost.PRE_LETTER_VIEW, prepost.PRE_CG_LETTER_SCALE_ALL, prepost.DOSAGE_CATEGORY, prepost.TTL_TIME, prepost.POST_ELA_CG_VALUE, prepost.POST_ELA_CG_VALUE_DISPLAY, prepost.POST_ELA_CG_VALUE_NUM, prepost.POST_ELA_DESC, prepost.POST_ELA_FREQ, prepost.POST_ELA_TRACK, prepost.POST_ELA_TRACK_EVAL, prepost.POST_SCENARIO, prepost.POST_LETTER_VIEW, prepost.POST_CG_LETTER_SCALE_ALL, prepost.LETTERGADE_CHANGE_ACTUAL, prepost.LETTERGADE_CHANGE_GENERAL, prepost.CG_Performance_Level_Change, prepost.CG_Change, prepost.Enrollment_Duration, prepost.ENROLL_DAYS, prepost.STATUS_SITE_DOSAGE_GOAL, prepost.SITE_DOSAGE_GOAL, prepost.Attendance_IA, prepost.ELA_IA, prepost.Math_IA, prepost.Behavior_IA, prepost.FISCAL_YEAR, ReportCYData.dbo.RPT_SCHOOL_GRADE.INDICATOR_ID, ReportCYData.dbo.RPT_SCHOOL_GRADE.B_RULE_VAL1, ReportCYData.dbo.RPT_SCHOOL_GRADE.B_RULE_VAL2, ReportCYData.dbo.RPT_SCHOOL_GRADE.B_RULE_VAL3, ReportCYData.dbo.RPT_SCHOOL_GRADE.B_RULE_VAL4, ReportCYData.dbo.RPT_SCHOOL_GRADE.B_RULE_VAL5,
CASE WHEN ReportCYData.dbo.RPT_STUDENT_MAIN.GRADE_ID = 21 THEN -1 WHEN ReportCYData.dbo.RPT_STUDENT_MAIN.GRADE_ID = 22 THEN 0 ELSE ReportCYData.dbo.RPT_STUDENT_MAIN.GRADE_ID END AS GRADE_ID_RECODE,
CASE WHEN prepost.TTL_TIME >= ReportCYData.dbo.RPT_SCHOOL_GRADE.B_RULE_VAL2 THEN 1 WHEN prepost.TTL_TIME < ReportCYData.dbo.RPT_SCHOOL_GRADE.B_RULE_VAL2 THEN 0 ELSE NULL END AS MY_MET_MARCH_DOSAGE,
MY_PROXY_ELA_CG.INTERVAL AS PROXY_ELA_FREQ, MY_PROXY_ELA_CG.SCALE_LOCAL AS PROXY_ELA_TRACK, MY_PROXY_ELA_CG.CG_LETTER_VIEW AS PROXY_LETTER_VIEW, MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL AS PROXY_CG_LETTER_SCALE_ALL,
CASE WHEN prepost.POST_ELA_FREQ IS NULL AND (prepost.PRE_ELA_FREQ < MY_PROXY_ELA_CG.INTERVAL OR prepost.PRE_ELA_FREQ LIKE 'ELA/Literacy PrYr/Cumulative') THEN MY_PROXY_ELA_CG.INTERVAL ELSE prepost.POST_ELA_FREQ END AS MY_ELA_FREQ,
CASE WHEN prepost.POST_ELA_FREQ IS NULL AND (prepost.PRE_ELA_FREQ < MY_PROXY_ELA_CG.INTERVAL OR prepost.PRE_ELA_FREQ LIKE 'ELA/Literacy PrYr/Cumulative') THEN MY_PROXY_ELA_CG.SCALE_LOCAL ELSE prepost.POST_ELA_TRACK END AS MY_ELA_TRACK,
CASE WHEN prepost.POST_ELA_FREQ IS NULL AND (prepost.PRE_ELA_FREQ < MY_PROXY_ELA_CG.INTERVAL OR prepost.PRE_ELA_FREQ LIKE 'ELA/Literacy PrYr/Cumulative') THEN MY_PROXY_ELA_CG.CG_LETTER_VIEW ELSE prepost.POST_LETTER_VIEW END AS MY_LETTER_VIEW,
CASE WHEN prepost.POST_ELA_FREQ IS NULL AND (prepost.PRE_ELA_FREQ < MY_PROXY_ELA_CG.INTERVAL OR prepost.PRE_ELA_FREQ LIKE 'ELA/Literacy PrYr/Cumulative') THEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL ELSE prepost.POST_CG_LETTER_SCALE_ALL END AS MY_CG_LETTER_SCALE_ALL,
CASE WHEN prepost.PRE_CG_LETTER_SCALE_ALL LIKE '1' THEN 1 WHEN prepost.PRE_CG_LETTER_SCALE_ALL LIKE '2' THEN 2 WHEN prepost.PRE_CG_LETTER_SCALE_ALL LIKE '3' THEN 2 WHEN prepost.PRE_CG_LETTER_SCALE_ALL LIKE '4' THEN 2 WHEN prepost.PRE_CG_LETTER_SCALE_ALL LIKE '5' THEN 3 WHEN prepost.PRE_CG_LETTER_SCALE_ALL LIKE '6' THEN 3 WHEN prepost.PRE_CG_LETTER_SCALE_ALL LIKE '7' THEN 3 WHEN prepost.PRE_CG_LETTER_SCALE_ALL LIKE '8' THEN 4 WHEN prepost.PRE_CG_LETTER_SCALE_ALL LIKE '9' THEN 4 WHEN prepost.PRE_CG_LETTER_SCALE_ALL LIKE '10' THEN 4 WHEN prepost.PRE_CG_LETTER_SCALE_ALL LIKE '11' THEN 5 WHEN prepost.PRE_CG_LETTER_SCALE_ALL LIKE '12' THEN 5 WHEN prepost.PRE_CG_LETTER_SCALE_ALL LIKE '13' THEN 5 ELSE NULL END AS OG_PRE_ELA_CG_NUM,
CASE WHEN prepost.POST_CG_LETTER_SCALE_ALL LIKE '1' THEN 1 WHEN prepost.POST_CG_LETTER_SCALE_ALL LIKE '2' THEN 2 WHEN prepost.POST_CG_LETTER_SCALE_ALL LIKE '3' THEN 2 WHEN prepost.POST_CG_LETTER_SCALE_ALL LIKE '4' THEN 2 WHEN prepost.POST_CG_LETTER_SCALE_ALL LIKE '5' THEN 3 WHEN prepost.POST_CG_LETTER_SCALE_ALL LIKE '6' THEN 3 WHEN prepost.POST_CG_LETTER_SCALE_ALL LIKE '7' THEN 3 WHEN prepost.POST_CG_LETTER_SCALE_ALL LIKE '8' THEN 4 WHEN prepost.POST_CG_LETTER_SCALE_ALL LIKE '9' THEN 4 WHEN prepost.POST_CG_LETTER_SCALE_ALL LIKE '10' THEN 4 WHEN prepost.POST_CG_LETTER_SCALE_ALL LIKE '11' THEN 5 WHEN prepost.POST_CG_LETTER_SCALE_ALL LIKE '12' THEN 5 WHEN prepost.POST_CG_LETTER_SCALE_ALL LIKE '13' THEN 5 ELSE NULL END AS OG_POST_ELA_CG_NUM,
CASE WHEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL LIKE '1' THEN 1 WHEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL LIKE '2' THEN 2 WHEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL LIKE '3' THEN 2 WHEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL LIKE '4' THEN 2 WHEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL LIKE '5' THEN 3 WHEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL LIKE '6' THEN 3 WHEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL LIKE '7' THEN 3 WHEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL LIKE '8' THEN 4 WHEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL LIKE '9' THEN 4 WHEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL LIKE '10' THEN 4 WHEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL LIKE '11' THEN 5 WHEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL LIKE '12' THEN 5 WHEN MY_PROXY_ELA_CG.CG_LETTER_VIEW_ALL LIKE '13' THEN 5 ELSE NULL END AS OG_PROXY_ELA_CG_NUM
FROM ReportCYData.dbo.RPT_SCHOOL_GRADE INNER JOIN (ReportCYData.dbo.RPT_STUDENT_MAIN INNER JOIN (ReportCYData.dbo.EVAL_ELA AS prepost LEFT JOIN
(SELECT allELA1.CONFIG_ID, allELA1.STUDENT_ID, allELA1.FREQUENCY_PERIOD_ID, allELA1.SKILL_ID, allELA1.SKILL_DESCRIPTION, allELA1.INTERVAL, allELA1.INDICATOR_DESC, allELA1.FREQ_SORT, allELA1.SCHOOL_NAME, allELA1.SITE_NAME, allELA1.STUDENT_NAME, allELA1.SCHOOL_ID, allELA1.SITE_ID, allELA1.PERF_DATE, allELA1.PERFORMANCE_VALUE, allELA1.PERFORMANCE_VALUE_NUMERIC, allELA1.SCALE_LOCAL, allELA1.SCALE_EVAL, allELA1.SCALE_TYPE, allELA1.PERF_DIRECTION, allELA1.PROC_TYPE, allELA1.PERF_RUN_DATE, allELA1.INDICATOR_AREA_ID, allELA1.CONFIG_NAME, allELA1.PRIMARY_CM, allELA1.INTERVENTION_TIME, allELA1.DATA_POINT, allELA1.CG_VALUE_DISPLAY, allELA1.CG_VALUE_NUM, allELA1.CG_LETTER_VIEW, allELA1.CG_LETTER_VIEW_ALL, allELA1.Tag, allELA1.FISCAL_YEAR
FROM ReportCYData.dbo.RPT_PERFORMANCE_LEVEL AS allELA1 LEFT JOIN ReportCYData.dbo.RPT_PERFORMANCE_LEVEL AS allELA2
ON allELA1.STUDENT_ID = allELA2.STUDENT_ID AND allELA1.INDICATOR_DESC = allELA2.INDICATOR_DESC AND allELA1.FREQ_SORT < allELA2.FREQ_SORT
WHERE allELA1.SKILL_DESCRIPTION LIKE 'ELA Course Grade' AND allELA1.Tag IS NULL AND allELA1.FISCAL_YEAR LIKE '2014-2015' AND allELA2.STUDENT_ID IS NULL)
AS MY_PROXY_ELA_CG ON (prepost.STUDENT_ID = MY_PROXY_ELA_CG.STUDENT_ID)) ON (ReportCYData.dbo.RPT_STUDENT_MAIN.STUDENT_ID = prepost.STUDENT_ID)) ON (ReportCYData.dbo.RPT_SCHOOL_GRADE.SCHOOL_ID = prepost.SCHOOL_ID AND ReportCYData.dbo.RPT_SCHOOL_GRADE.GRADE_ID = ReportCYData.dbo.RPT_STUDENT_MAIN.GRADE_ID)
WHERE ReportCYData.dbo.RPT_SCHOOL_GRADE.INDICATOR_ID = 3 AND ReportCYData.dbo.RPT_SCHOOL_GRADE.FISCAL_YEAR LIKE '2014-2015' AND prepost.FISCAL_YEAR LIKE '2014-2015')
AS MY_PROXY_ELA_CG2)
AS ELACG LEFT JOIN ReportCYData.dbo.RPT_LETTER_CHANGE_DEGREE AS LETTERCHANGE
ON ELACG.MY_LETTERGRADE_CHANGE_ACTUAL LIKE LETTERCHANGE.LetterGrade_Change_Actual
ORDER BY SITE_NAME, SCHOOL_NAME, GRADE_ID, STUDENT_ID;